<%- include ('partials/head') %>
    <div class="container my-4">
        <h1 class="display-6 mb-3 text-uppercase fw-bold">
            <%= title %>
        </h1>
        <div class="mb-4">
            <div style="background: #cfe2ff; border-radius: 1rem; padding: 1rem 1.5rem; color: #084298; font-size: 1.3rem; font-weight: bold; box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
                Bienvenidos a la APP Salud
            </div>
        </div>
        
        <% if (message) { %>
            <div class="alert alert-info"><strong>
                    <%= message %>
                </strong></div>
            <% } %>

                <div class="card mb-4">
                    <div class="card-header">
                        <h2 class="h6 mb-0">Lista de Pacientes</h2>
                    </div>
                    <div class="card-body p-0">
                        <% if (pacientes && pacientes.length> 0) { %>
                            <div class="table-responsive">
                                <table class="table table-striped table-hover mb-0">
                                    <thead class="table-light">
                                        <tr>
                                            <th>ID</th>
                                            <th>Nombre</th>
                                            <th>Apellidos</th>
                                            <th>Fecha de Nacimiento</th>
                                            <th>Peso (kg)</th>
                                            <th>Temp (°C)</th>
                                            <th>Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <% pacientes.forEach(paciente=> { %>
                                            <tr>
                                                <td>
                                                    <%= paciente.id %>
                                                </td>
                                                <td>
                                                    <%= paciente.nombre %>
                                                </td>
                                                <td>
                                                    <%= paciente.apellidos %>
                                                </td>
                                                <td>
                                                    <% 
                                                        let fecha = paciente.fechaNacimiento;
                                                        let fechaValida = fecha && !isNaN(new Date(fecha).getTime());
                                                    %>
                                                    <%= fechaValida ? new Date(fecha).toISOString().slice(0, 10) : 'N/D' %>
                                                </td>
                                                <td>
                                                    <%= paciente.peso !=null ? Number(paciente.peso).toFixed(2) : 'N/D'
                                                        %>
                                                </td>
                                                <td>
                                                    <%= paciente.temperatura !=null ?
                                                        Number(paciente.temperatura).toFixed(1) : 'N/D' %>
                                                </td>
                                                <td>
                                                    <a href="/pacientes/<%= paciente.id %>"
                                                        class="btn btn-sm btn-primary me-1">Ver</a>
                                                    <a href="/pacientes/editar/<%= paciente.id %>"
                                                        class="btn btn-sm btn-secondary me-1">Editar</a>
                                                    <form action="/pacientes/<%= paciente.id %>?_method=DELETE"
                                                        method="POST" class="d-inline">
                                                        <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                                                        <button type="submit"
                                                            class="btn btn-sm btn-danger">Eliminar</button>
                                                    </form>
                                                </td>
                                            </tr>
                                            <% }) %>
                                    </tbody>
                                </table>
                            </div>
                            <% } else { %>
                                <div class="p-3">No hay pacientes registrados.</div>
                                <% } %>
                    </div>
                </div>

                <div class="card mb-4">
                    <div class="card-header">
                        <h3 class="h6 mb-0">Agregar Nuevo Paciente</h3>
                    </div>
                    <div class="card-body">
                        <form action="/pacientes" method="POST" class="row g-3">
                            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                            <div class="col-md-4">
                                <label class="form-label">Nombre:</label>
                                <input class="form-control" type="text" name="nombre" required>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Apellidos:</label>
                                <input class="form-control" type="text" name="apellidos" required>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Fecha de Nacimiento:</label>
                                <input class="form-control" type="date" name="fechaDeNacimiento" required>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Peso (kg):</label>
                                <input class="form-control" type="number" step="0.01" name="peso">
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Temperatura (°C):</label>
                                <input class="form-control" type="number" step="0.1" name="temperatura">
                            </div>
                            <div class="col-12">
                                <button class="btn btn-success" type="submit">Crear Paciente</button>
                            </div>
                        </form>
                    </div>
                </div>

                <hr>
                <p><a href="/pacientes" class="btn btn-link p-0">Actualizar lista</a></p>
    </div>


    <%- include ('partials/footer') %>